<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page @NPR - Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <nav id="navbar" class="navbar">
        <div class="logo">
            <a href="/">NPR@ACM</a>
        </div>
        <div class="links">
            <a href="/">Events</a>
            <a href="/gallery">Gallery</a>
            <a href="/outreach">OutReach</a>
            <a href="/recent">Recent Events</a>
            <a href="/logout">Log Out as Admin</a>
        </div>
    </nav>

    <section id="events">
       <div class="container">
            <div class="main-text">
                <h1 class="text-center">These are the List of Gallery's</h1> 
                <p class="text-muted text-center">Click Here To Upload <a href="/upload/gallery" class="text-black-50">Upload Gallery</a></p>
            </div>
        <div class="row">
            
        </div>
    </div>
    </section>
    
    
    <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalTitle">Event Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 order-md-2 text-center mb-3 mb-md-0">
                            <img id="modalImg" class="img-fluid rounded" alt="Event Image" style="max-height: 200px;">
                            <div class="mt-2">
                                <small id="modalTime" class="text-muted"><i class="fas fa-clock me-1"></i> <span id="timeText"></span></small>
                            </div>
                        </div>
                        <div class="col-md-6 order-md-1">
                            <h3 id="modalTitle" class="text-primary mb-3"></h3>
                            <div class="event-details">
                                <div class="detail-item mb-2">
                                    <i class="fas fa-calendar-day text-primary me-2"></i>
                                    <span id="modalDate"></span>
                                </div>
                                <div class="detail-item mb-3">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    <span id="modalLoc"></span>
                                </div>
                                <div class="description-container">
                                    <h6 class="text-muted">Description:</h6>
                                    <p id="modalDescription" class="text-muted"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" >
                    <button class="btn btn-danger" id="gedit">
                        <i class="fas fa-edit me-1"></i> Edit
                    </button>
                    <button class="btn btn-warning" id="gdel">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Nata+Sans:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body{
        font-family: "Poppins", sans-serif;
        font-weight: 400;
        font-style: normal;
    }
    nav{
        width:100%;
        height: 65px;
        box-shadow: 1px 1px 0px black;
    }
    nav .logo{
        margin-left: 20px;
    }

    nav .logo a{
        font-size: 25px;
        text-decoration: none;
        color:#01015a;
        font-weight: 800;
        font-style: italic;
    }
    nav .links{
        display: flex;
        gap:40px;
        margin-right: 20px;
    }

    nav .links a{
        text-decoration: none;
        font-size: 20px;
        font-weight: 600;
        color: #01015a;
    }

    nav .links a:hover{
        color: rgb(245, 7, 7);
    }
    #events{
        margin-top: 50px;
    }
    
    nav .link .active{
        color: rgb(245, 7, 7);
    }

    .modal-content {
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border: none;
    }
    
    .detail-item {
        display: flex;
        align-items: center;
    }
    
    .description-container {
        background-color: #f8f9fa;
        padding: 12px;
        border-radius: 8px;
        border-left: 4px solid #0d6efd;
    }
</style>

<script>

    let API = '{{API}}';

    function Load_Gallery() {
        return fetch(`${API}/api/gallery/`).then(res => res.json());
    }

    function Get_Gallerys() {
        Load_Gallery().then(data => {
            if (data.Success===true) {
                let row = document.querySelector(".row");
                row.innerHTML = ""; 

                data.gallerys.forEach((gallery, index) => {
                    
                    let carouselId = `carousel${index}`;

                    let card = `
                        <div class="col-md-4 mb-4">
                            <div class="card shadow-sm h-100">
                                <div id="${carouselId}" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        ${gallery.imgs.map((img, i) => `
                                            <div class="carousel-item ${i === 0 ? 'active' : ''}">
                                                <img src="${img}" class="d-block w-100" alt="gallery image" style="height:200px; object-fit:cover;">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon"></span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
                                        <span class="carousel-control-next-icon"></span>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">${gallery.title}</h5>
                                    <p class="card-text">${gallery.des1 || ''}</p>
                                    <p class="card-text"><small class="text-muted">${gallery.head2 || ''}</small></p>
                                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#eventModal"
                                        onclick='openModal(${JSON.stringify(gallery)})'>
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    row.innerHTML += card;
                });
            }
        });
    }

    function openModal(gallery) {
        document.getElementById("modalTitle").innerText = gallery.title;
        document.getElementById("modalDescription").innerText = gallery.des1 + " " + gallery.des2 + " " + gallery.des3;
        document.getElementById("modalLoc").innerText = gallery.head2 || "Unknown";
        document.getElementById("modalDate").innerText = gallery.head1 || "No Date";
        document.getElementById("modalImg").src = gallery.imgs[0] || "";
        document.getElementById("timeText").innerText = gallery.head3 || "";

        let gedit = document.getElementById("gedit")

    gedit.onclick = function(){
         window.location.href = `/update-gallery/${gallery._id}`
    }

     let gdel = document.getElementById("gdel")
   gdel.onclick=function(){
       Delete_Galley(gallery._id)
   }
    function Delete_Galley(id){
         fetch(`${API}/api/gallery/delete/${id}` , {method:"DELETE"}).then(res=>res.json()).then(data=>{
            if(data.Success==true){
               window.location.reload()
            }
         })
    }
    }


    let routes = {
        "Events":"/",
        "Gallery":"/gallery",
        "OutReach":"/outreach",
        "Recent Events":"/recent"
    }


    let links = document.querySelector(".links")
    let a = links.querySelectorAll("a")

    a.forEach(as=>{
        
            console.log(as.innerText)
            if(window.location.pathname == routes[as.innerText]){
                as.style.color = "rgb(245, 7, 7)"
                
            }
    })



    
    
    window.addEventListener("DOMContentLoaded", Get_Gallerys);
</script>

