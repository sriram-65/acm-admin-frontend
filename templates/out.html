<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Page @NPR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  {%include 'load.html'%}
   {%include 'nav.html'%}
   
   
<main>
  

  <section id="outreach">
    <div class="container">
      <div class="main-text">
        <h1 class="text-center">These are the List of OutReach</h1> 
        <p class="text-muted text-center">Click Here To Upload <a href="/upload/outreach" class="text-black-50">Upload OutReach</a></p>
      </div>
      <div class="row"></div>
    </div>
  </section>

  <!-- Modal -->
  <div class="modal fade" id="outreachModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="modalTitle">OutReach Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 order-md-2 text-center mb-3 mb-md-0">
              <img id="modalImg" class="img-fluid rounded" alt="OutReach Image" style="max-height: 200px;">
            </div>
            <div class="col-md-6 order-md-1">
              <h3 id="modalTitleText" class="text-primary mb-3"></h3>
              <div class="event-details">
                <div class="detail-item mb-2">
                  <i class="fas fa-align-left text-primary me-2"></i>
                  <span id="modalCaption"></span>
                </div>
                <div class="description-container">
                  <h6 class="text-muted">Description:</h6>
                  <p id="modalDescription" class="text-muted"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
         
          <button class="btn btn-danger" id="oedit">
            <i class="fas fa-edit me-1"></i> Edit
          </button>
           <button class="btn btn-warning" id="odel">
            <i class="fas fa-trash-alt me-1"></i> Delete
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  </main>

</body>
</html>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Nata+Sans:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

  body { font-family: "Poppins", sans-serif; }
  nav { width:100%; height: 65px; box-shadow: 1px 1px 0px black; }
  nav .logo { margin-left: 20px; }
  nav .logo a { font-size: 25px; text-decoration: none; color:#01015a; font-weight: 800; font-style: italic; }
  nav .links { display: flex; gap:40px; margin-right: 20px; }
  nav .links a { text-decoration: none; font-size: 20px; font-weight: 600; color: #01015a; }
  nav .links a:hover { color: rgb(245, 7, 7); }
  #outreach { margin-top: 50px; }
  .modal-content { border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); border: none; }
  .detail-item { display: flex; align-items: center; }
  .description-container { background-color: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #0d6efd; }
</style>

<script>
  let API = '{{API}}'

  function Get_OutReach(){
    return fetch(`${API}/api/outreach/`).then(res => res.json())
  }

  let row = document.querySelector(".row")

  function LOAD_ALL_OUTREACH(){
    row.innerHTML = ''
    Get_OutReach().then((data) => {
      if(data.Success){
        data.data.forEach(o => {
          let col = document.createElement("div")
          col.className = "col-md-4 mb-4"

          let card = document.createElement("div")
          card.className = "card shadow-sm h-100"

          let cardBody = document.createElement("div")
          cardBody.className = "card-body"

          let title = document.createElement("h5")
          title.className = "card-title fw-bold"
          title.innerText = o.title

          let caption = document.createElement("p")
          caption.className = "card-text text-muted"
          caption.innerText = o.des

          let btn = document.createElement("a")
          btn.className = "btn btn-primary mt-auto"
          btn.innerText = "Read More"
          btn.setAttribute("data-bs-toggle", "modal")
          btn.setAttribute("data-bs-target", "#outreachModal")
          btn.onclick = function(){ showPopup(o) }

          cardBody.appendChild(title)
          cardBody.appendChild(caption)
          cardBody.appendChild(btn)
          card.appendChild(cardBody)
          col.appendChild(card)
          row.appendChild(col)
        })
      }
    })
  }

  let OID;
  function showPopup(data){
    if(data){
      document.getElementById('modalTitleText').innerText = data.title;
      document.getElementById('modalCaption').innerText = data.des;
      document.getElementById('modalDescription').innerText = data.des1 || '';
      document.getElementById('modalImg').src = data.img;
      OID = data._id;
    }
  }

  function EditOutReach(name,id){ window.location.href = `${name}/${id}` }

  let odel = document.getElementById("odel")
  function Delete_OutReach(id){
    odel.disabled = true
    odel.innerHTML = 'Deleting...'
    fetch(`${API}/api/outreach/delete/${id}`, {method:"DELETE"})
      .then(res=>res.json())
      .then(data=>{
        if(data.Success){
          LOAD_ALL_OUTREACH()
          var myModalEl = document.getElementById('outreachModal');
          var modal = bootstrap.Modal.getInstance(myModalEl);
          modal.hide()
          odel.disabled=false
          odel.innerHTML='<i class="fas fa-trash-alt me-1"></i> Delete'
        } else {
          alert("Failed to Delete the OutReach!")
        }
      })
  }

  let oedit = document.getElementById("oedit")
  oedit.onclick = function(){ EditOutReach("update-outreach", OID) }
  odel.onclick = function(){ Delete_OutReach(OID) }

 function UserLoading(){
    fetch("https://acm-backend-admin.vercel.app/api/auth/me" , {
        method:"GET" , 
        credentials:"include"
    }).then(res=>res.json()).then(data=>{
        if(data.Success===true){
            document.querySelector(".user-load").style.display = "none"
            document.querySelector("main").style.display = 'block'
            LOAD_ALL_OUTREACH()
        }
        else{
            window.location.href = '/acm'
        }
    })
    }



    
    window.addEventListener("DOMContentLoaded",UserLoading);
</script>
